name: Tech Watch â†’ Discord

on:
  workflow_dispatch: {}
  schedule:
    # GitHub uses UTC. Keep daytime runs; script will enforce hard cutoff after 7PM ET.
    - cron: "0 13 * * *"   # ~09:00 ET
    - cron: "0 17 * * *"   # ~13:00 ET
    - cron: "0 22 * * *"   # ~18:00 ET (can be ~19:00 ET during DST; script must block after 7PM)

concurrency:
  group: tech-watch
  cancel-in-progress: false

jobs:
  run-tech-watch:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install deps
        run: |
          npm init -y >/dev/null 2>&1 || true
          npm i rss-parser node-fetch@3

      - name: Syntax check Tech Watch script
        run: node --check ./scripts/tech_watch_to_discord.mjs

      - name: Run Tech Watch
        env:
          TECH_WATCH_WEBHOOK: ${{ secrets.TECH_WATCH_WEBHOOK }}
          MAX_POSTS_PER_RUN: "3"
        run: node ./scripts/tech_watch_to_discord.mjs
