name: SEC Filings Scanner

on:
  schedule:
    - cron: "*/15 * * * *"
  workflow_dispatch:

jobs:
  run-script:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          pip install requests feedparser

      # ðŸ”Ž Print what the runner actually has and locate a script under scripts/*.py
      - name: Locate script (debug)
        id: locate
        run: |
          set -e
          echo "Branch: $(git rev-parse --abbrev-ref HEAD)"
          echo "Repo root contents:"
          ls -la
          echo "---- scripts ----"
          ls -la scripts || true
          echo "---- find python scripts ----"
          FILE="$(git ls-files 'scripts/*.py' | head -n1 || true)"
          echo "Found script: $FILE"
          if [ -z "$FILE" ]; then
            echo "No Python script found under scripts/; did you commit it to this branch?" >&2
            echo "Tip: create scripts/edgar_to_discord.py and commit." >&2
            exit 1
          fi
          echo "file=$FILE" >> $GITHUB_OUTPUT

      - name: Run SEC Filings Script
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          python "${{ steps.locate.outputs.file }}"
